# Виртуальный Тьютор - Серверная часть

Этот каталог содержит серверные компоненты системы Виртуального Тьютора, отвечающие за:
- Обработку WebSocket-соединений
- Управление взаимодействием "тьютор-студент"
- Анализ эмоционального состояния
- Контроль потока диалога

## Структура файлов и их назначение

### Основные компоненты:

1. **`base_moral_scheme.py`** - Ядро эмоционального интеллекта
   - Реализует моральные схемы и расчет эмоциональных векторов
   - Отслеживает эмоциональное состояние студента через:
     - `appraisals`: Как студент оценивает ситуацию
     - `feelings`: Реальное эмоциональное состояние
   - Ключевые методы:
     - `update_vectors()`: Обновляет состояние на основе новых данных
     - `euc_dist()`: Вычисляет эмоциональную дистанцию между состояниями

2. **`oai_interface.py`** - Слой взаимодействия с API
   - Обрабатывает все запросы к Deepseek API
   - Основные функции:
     - `get_composition()`: Анализирует намерения студента
     - `get_replic()`: Генерирует контекстно-зависимые ответы
     - `get_brain_status()`: Определяет переходы между этапами
   - Реализует логику повторных попыток запросов

3. **`virtual_tutor.py`** - Логика тьютора
   - Содержит две реализации:
     - `DummyVirtualTutor`: Простой генератор ответов
     - `VirtualTutor`: Полная версия с эмоциональным интеллектом
   - Управляет:
     - Историей диалога
     - Прогрессом по этапам
     - Отслеживанием эмоционального состояния
   - Использует 4 моральные схемы для разных этапов

4. **`test_server.py`** - FastAPI приложение
   - WebSocket-эндпоинты:
     - `/test_1/ws/{id}`: Для простого тьютора
     - `/test_2/ws/{id}`: Для полноценного тьютора
   - Отдача статических файлов веб-интерфейса
   - Управление соединениями

### Вспомогательные файлы:

5. **`helper.py`** - Конфигурация и константы
   - Содержит:
     - Определения эмоциональных пространств
     - Сообщения для переходов между этапами
     - Системные промпты
     - Загрузчик конфигурации
   - Определяет все эмоциональные параметры для 4 этапов

6. **`request_contracts.py`** - Модели данных
   - Pydantic-модели для валидации API
   - `TextItem`: Для текстовых запросов
   - `EmotionItem`: Для эмоционального анализа

7. **`test_client.py`** - Инструмент тестирования API
   - Пример клиента для тестирования Deepseek API
   - Демонстрирует базовую структуру запроса

## Ключевые процессы

### Отслеживание эмоционального состояния:
1. Сообщение студента → Анализ намерений → Обновление векторов
2. Расчет эмоциональной дистанции → Корректировка состояния
3. Генерация ответа с учетом текущего состояния

### Поток диалога:

Этап 1: Знакомство
↓ (студент соглашается)
Этап 2: Создание outline
↓ (outline утвержден)
Этап 3: Написание эссе
↓ (эссе завершено)
Этап 4: Финальная оценка


### WebSocket-взаимодействие:

    Клиент->>Сервер: Подключение (WS)
    Сервер->>Тьютор: Создание сессии
    Клиент->>Сервер: Отправка сообщения
    Сервер->>Тьютор: Обработка сообщения
    Тьютор->>Deepseek: API запрос
    Deepseek->>Тьютор: Ответ
    Тьютор->>Сервер: Сгенерированный ответ
    Сервер->>Клиент: Отправка ответа


### Логирование
Система генерирует детальные логи в:

    logs_dummy/ - Для простого тьютора

    logs_moral/ - Для полной версии

Каждая сессия получает отдельную директорию с:

    dialog.log: Полная история диалога

    essay.log: Прогресс написания эссе

Зависимости
    FastAPI (поддержка WebSocket)

    Uvicorn (ASGI сервер)

    NumPy (Векторные вычисления)

    PyYAML (Парсинг конфигурации)

    Requests (API взаимодействие)